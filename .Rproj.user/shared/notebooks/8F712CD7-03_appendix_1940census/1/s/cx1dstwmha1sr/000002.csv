"0","## read in matched data "
"0","matched_data <- matched_data %>% "
"0"," mutate(census_race = case_when("
"0","   RACE == 100 ~ 1,"
"0","   RACE == 200 ~ 2"
"0"," )) %>% "
"0","  filter(race_first %in% c(1:2))  %>% "
"0","  filter(census_race %in% c(1:2))"
"0",""
"0","matched_data_subset <- matched_data %>% "
"0","  mutate(race_first_string = case_when("
"0","    race_first == 1 ~ ""White"","
"0","    race_first == 2 ~ ""Black"""
"0","  ),"
"0","  race_last_string = case_when("
"0","    census_race == 1 ~ ""White"","
"0","    census_race == 2 ~ ""Black"""
"0","  ))"
"0",""
"0","transition_matrix <- matched_data_subset %>%"
"0","  filter(!is.na(race_first_string) & !is.na(race_last_string)) %>% "
"0","  group_by(race_first_string, race_last_string) %>%"
"0","  summarize(n = n()) %>% "
"0","  mutate(freq = n / sum(n)) %>% "
"0","  mutate(freq_categorical = cut(freq, c(0, .5, .9, 1))) %>% "
"0","  mutate(freq_label = paste0(round(100*freq,1), ""%"")) %>% "
"0","  ggplot(aes(x = race_last_string, y = race_first_string, fill = freq_categorical)) + "
"0","    geom_tile() +"
"0","  geom_text(aes(color = freq < 0.5, label = freq_label), size= 8) +"
"0","scale_color_manual(guide = FALSE, values = c(""black"", ""white"")) +"
"0","    #facet_grid(ego_sex ~ alter_sex) +"
"0","    coord_equal()  + "
"0","    viridis::scale_fill_viridis(name=str_wrap(""Frequency"", width=10), alpha = 1, na.value=""grey"", discrete = T) +"
"0","  #theme_minimal() +"
"0","  theme_minimal(base_size = 20) +"
"0","  theme(axis.text.x = element_text(angle=90, hjust=1, vjust=.5),"
"0","        axis.title = element_text(size = 15),"
"0","        plot.title = element_text(size=22)) + "
"0","  labs(title = """","
"0","         x = ""Last Ethnoracial Category"","
"0","      y = ""First Ethnoracial Category"") + "
"0","  theme(legend.position = ""none"")"
"2","`summarise()` has grouped output by 'race_first_string'. You can override using the `.groups` argument."
"0","ggsave(plot = transition_matrix, filename = here(""figures/transition_matrix_1940.png""), width = 6, height = 6)"
