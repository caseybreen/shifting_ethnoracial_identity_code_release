"0","## Construct a transition matrix "
"0","transition_matrix <- numident_sample %>%"
"0","  # filter(bpl < 15000) %>% "
"0","  filter(!is.na(race_first_string) & !is.na(race_last_string)) %>% "
"0","  group_by(race_first_string, race_last_string) %>%"
"0","  summarize(n = n()) %>% "
"0","  mutate(freq = n / sum(n)) %>% "
"0","  mutate(freq_categorical ="
"0","             cut(freq,"
"0","                 c(0, 0.005, .01, .05, .1, .8, .9, 1), "
"0","                 labels = c(""Low"","
"0","                              "" "", "
"0","                             ""   "","
"0","                             ""     "","
"0","                             ""       "","
"0","                             ""          "","
"0","                             ""High""),"
"0","                 include.lowest = FALSE)) %>% "
"0","  mutate(freq_label = paste0(round(100*freq,1), ""%"")) %>% "
"0","  ggplot(aes(x = race_last_string, y = race_first_string, fill = freq_categorical)) + "
"0","    geom_tile() +"
"0","  geom_text(aes(color = freq < 0.5, label = freq_label), size= 8) +"
"0","scale_color_manual(guide = FALSE, values = c(""black"", ""white"")) +"
"0","    #facet_grid(ego_sex ~ alter_sex) +"
"0","    coord_equal()  + "
"0","    viridis::scale_fill_viridis(name=str_wrap(""Frequency"", width=10), alpha = 1, na.value=""grey"", discrete = T) +"
"0","  #theme_minimal() +"
"0","  theme_minimal(base_size = 20) +"
"0","  theme(axis.text.x = element_text(angle=90, hjust=1, vjust=.5),"
"0","        axis.title = element_text(size = 15),"
"0","        plot.title = element_text(size=22)) + "
"0","  labs(title = """","
"0","         x = ""Last Ethnoracial Group"","
"0","      y = ""First Ethnoracial Group"") + "
"0","  theme()"
"2","`summarise()` has grouped output by 'race_first_string'. You can override using the `.groups` argument."
"0","ggsave(plot = transition_matrix, filename = here(""figures/transition_matrix_all.png""), width = 11, height = 11)"
"0",""
"0","## transition matrix domestic-born â€” for analysis in appendix "
"0",""
"0","transition_matrix_native <- numident_sample %>%"
"0","  filter(bpl < 15000) %>% ## restrict to domestic-born "
"0","  filter(!is.na(race_first_string) & !is.na(race_last_string)) %>% "
"0","  group_by(race_first_string, race_last_string) %>%"
"0","  summarize(n = n()) %>% "
"0","  mutate(freq = n / sum(n)) %>% "
"0","  mutate(freq_categorical ="
"0","             cut(freq,"
"0","                 c(0, 0.005, .01, .05, .1, .8, .9, 1), "
"0","                 labels = c(""Low"","
"0","                              "" "", "
"0","                             ""   "","
"0","                             ""     "","
"0","                              ""       "","
"0","                             ""          "","
"0","                             ""High""),"
"0","                 include.lowest = FALSE)) %>% "
"0","  mutate(freq_label = paste0(round(100*freq,1), ""%"")) %>% "
"0","  ggplot(aes(x = race_last_string, y = race_first_string, fill = freq_categorical)) + "
"0","    geom_tile() +"
"0","  geom_text(aes(color = freq < 0.5, label = freq_label), size= 8) +"
"0","scale_color_manual(guide = FALSE, values = c(""black"", ""white"")) +"
"0","    #facet_grid(ego_sex ~ alter_sex) +"
"0","    coord_equal()  + "
"0","    viridis::scale_fill_viridis(name=str_wrap(""Frequency"", width=10), alpha = 1, na.value=""grey"", discrete = T) +"
"0","  #theme_minimal() +"
"0","  theme_minimal(base_size = 20) +"
"0","  theme(axis.text.x = element_text(angle=90, hjust=1, vjust=.5),"
"0","        axis.title = element_text(size = 15),"
"0","        plot.title = element_text(size=22)) + "
"0","  labs(title = """","
"0","         x = ""Last Ethnoracial Group"","
"0","      y = ""First Ethnoracial Group"") + "
"0","  theme()"
"0",""
"0","## save transition matrix "
"0","ggsave(plot = transition_matrix_native, filename = here(""figures/transition_matrix_native.png""), width = 11, height = 11)"
